<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.db1.system.SysOperateLogMapper">
  <resultMap id="BaseResultMap" type="com.dao.entity.system.SysOperateLog">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="sort" jdbcType="INTEGER" property="sort" />
    <result column="order_id" jdbcType="VARCHAR" property="orderId" />
    <result column="parent_id" jdbcType="VARCHAR" property="parentId" />
    <result column="function_module" jdbcType="VARCHAR" property="functionModule" />
    <result column="system_name" jdbcType="VARCHAR" property="systemName" />
    <result column="depart" jdbcType="VARCHAR" property="depart" />
    <result column="dep_code" jdbcType="VARCHAR" property="depCode" />
    <result column="operate_time" jdbcType="TIMESTAMP" property="operateTime" />
    <result column="operate_type" jdbcType="INTEGER" property="operateType" />
    <result column="operate_result" jdbcType="INTEGER" property="operateResult" />
    <result column="operate_name" jdbcType="VARCHAR" property="operateName" />
    <result column="content" jdbcType="VARCHAR" property="content" />
    <result column="terminal_id" jdbcType="VARCHAR" property="terminalId" />
    <result column="error_code" jdbcType="VARCHAR" property="errorCode" />
    <result column="operate_condition" jdbcType="VARCHAR" property="operateCondition" />
    <result column="creator" jdbcType="VARCHAR" property="creator" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="next_date" jdbcType="TIMESTAMP" property="endDate" />
    <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from sys_operate_log
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.dao.entity.system.SysOperateLog">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into sys_operate_log (id, user_name, user_id, order_id,
    sort, parent_id,  function_module,
    system_name, depart, dep_code,
    operate_time, operate_type, operate_result, operate_name,
    content, terminal_id, error_code,
    operate_condition, creator, create_date,
    next_date, update_date, remark
    )
    values (#{id,jdbcType=VARCHAR}, #{userName,jdbcType=VARCHAR}, #{userId,jdbcType=VARCHAR}, #{orderId,jdbcType=VARCHAR},
    #{sort,jdbcType=INTEGER}, #{parentId,jdbcType=VARCHAR},  #{functionModule,jdbcType=VARCHAR},
    #{systemName,jdbcType=VARCHAR}, #{depart,jdbcType=VARCHAR}, #{depCode,jdbcType=VARCHAR},
    #{operateTime,jdbcType=TIMESTAMP}, #{operateType,jdbcType=INTEGER}, #{operateResult,jdbcType=INTEGER},#{operateName,jdbcType=VARCHAR},
    #{content,jdbcType=VARCHAR}, #{terminalId,jdbcType=VARCHAR}, #{errorCode,jdbcType=VARCHAR},
    #{operateCondition,jdbcType=VARCHAR}, #{creator,jdbcType=VARCHAR}, #{createDate,jdbcType=TIMESTAMP},
    #{endDate,jdbcType=TIMESTAMP}, #{updateDate,jdbcType=TIMESTAMP}, #{remark,jdbcType=VARCHAR}
    )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.dao.entity.system.SysOperateLog">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sys_operate_log
    set user_name = #{userName,jdbcType=VARCHAR},
    user_id = #{userId,jdbcType=VARCHAR},
    sort = #{sort,jdbcType=INTEGER},
    parent_id = #{parentId,jdbcType=VARCHAR},
    system_name = #{systemName,jdbcType=VARCHAR},
    depart = #{depart,jdbcType=VARCHAR},
    dep_code = #{depCode,jdbcType=VARCHAR},
    operate_time = #{operateTime,jdbcType=TIMESTAMP},
    operate_type = #{operateType,jdbcType=INTEGER},
    operate_result = #{operateResult,jdbcType=INTEGER},
    content = #{content,jdbcType=VARCHAR},
    terminal_id = #{terminalId,jdbcType=VARCHAR},
    error_code = #{errorCode,jdbcType=VARCHAR},
    operate_condition = #{operateCondition,jdbcType=VARCHAR},
    creator = #{creator,jdbcType=VARCHAR},
    create_date = #{createDate,jdbcType=TIMESTAMP},
    next_date = #{endDate,jdbcType=TIMESTAMP},
    update_date = #{updateDate,jdbcType=TIMESTAMP},
    remark = #{remark,jdbcType=VARCHAR}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, user_name, user_id, sort, parent_id, system_name, depart, dep_code,
    operate_time, operate_type, operate_result, content, terminal_id, error_code, operate_condition,
    creator, create_date, next_date, update_date, remark
    from sys_operate_log
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, user_name, user_id, sort, parent_id,  system_name, depart, dep_code,
    operate_time, operate_type, operate_result, content, terminal_id, error_code, operate_condition,
    creator, create_date, next_date, update_date, remark
    from sys_operate_log
  </select>
  <!--**********************************************   自定义开始   ********************************************************-->
  <!-- 根据条件分页查询行为操作日志  @author XieZX  date 2019/1/15!-->
  <select id="search" resultMap="BaseResultMap">
    select a.*
    from sys_operate_log a
    <!--,b.dep_name as departName,b.dep_name_abb as departNameAbb
    left join rep_dep_config b on a.dep_code=b.dep_code
    -->
    where 1=1
    <if test="startDate != null">
      and a.create_date <![CDATA[ >= ]]> #{startDate}
    </if>
    <if test="endDate != null">
      and a.create_date  <![CDATA[ <= ]]> #{endDate}
    </if>
    <if test="depCode != null">
      and a.dep_code like #{depCode}
    </if>
    <if test="operateType != null">
      and a.operate_type = #{operateType}
    </if>
    <if test="userName != null">
      and a.user_name = #{userName}
    </if>
    ORDER BY  operate_time desc
  </select>
  <!-- 根据条件统计各地区操作次数_柱状图  @author XieZX  date 2019/1/17!-->
  <select id="departHistogram" resultType="java.util.HashMap">
    select count(1) as operateTimes,days as dateStr from (
    select date_format(a.operate_time,'%Y-%m-%d') as days,a.*
    from sys_operate_log a
    where 1=1
    and operate_time is not NULL
    <if test="startDate != null">
      and a.operate_time <![CDATA[ >= ]]> #{startDate}
    </if>
    <if test="endDate != null">
      and a.operate_time  <![CDATA[ <= ]]> #{endDate}
    </if>
    <if test="depCode != null">
      and a.dep_code LIKE concat(#{depCode},'%')
    </if>
    <if test="operateType != null">
      and a.operate_type = #{operateType}
    </if>
    <if test="userName != null">
      and a.user_name = #{userName}
    </if>
    ) r  group by days
  </select>

  <!-- 根据条件统计各地区操作次数_饼图  @author XieZX  date 2019/1/17!-->
  <select id="departPie" resultType="java.util.HashMap">
    select count(1) as operateTimes
    from sys_operate_log a
    where 1=1
    and operate_time is not NULL
    <if test="startDate != null">
      and a.operate_time <![CDATA[ >= ]]> #{startDate}
    </if>
    <if test="endDate != null">
      and a.operate_time  <![CDATA[ <= ]]> #{endDate}
    </if>
    <if test="depCode != null">
      and a.dep_code LIKE concat(#{depCode},'%')
    </if>
  </select>
</mapper>